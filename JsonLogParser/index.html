<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>JsonLogParser - HPC Cost Simulator</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/python.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
            <div class="container">
                <a class="navbar-brand" href="..">HPC Cost Simulator</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">HPC Cost Simulator (HCS)</a>
                            </li>
                            <li class="navitem">
                                <a href="../AcceleratorLogParser/" class="nav-link">Altair Accelerator</a>
                            </li>
                            <li class="navitem">
                                <a href="../LSFLogParser/" class="nav-link">IBM Spectrum LSF</a>
                            </li>
                            <li class="navitem">
                                <a href="../SlurmLogParser/" class="nav-link">Slurm</a>
                            </li>
                            <li class="navitem active">
                                <a href="./" class="nav-link">JsonLogParser</a>
                            </li>
                            <li class="navitem">
                                <a href="../JobAnalyzer/" class="nav-link">Job Analyzer</a>
                            </li>
                            <li class="navitem">
                                <a href="../Output/" class="nav-link">Output</a>
                            </li>
                            <li class="navitem">
                                <a href="../config/" class="nav-link">Config</a>
                            </li>
                            <li class="navitem">
                                <a href="../model-scheduling/" class="nav-link">Model How Jobs Would Be Scheduled on AWS</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../SlurmLogParser/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../JobAnalyzer/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/aws-samples/hpc-cost-simulator/edit/master/docs/JsonLogParser.md" class="nav-link"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#jsonlogparser" class="nav-link">JsonLogParser</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#json-jobs-file-format" class="nav-link">JSON Jobs File Format</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#json-schema-map-file-format" class="nav-link">JSON Schema Map File Format</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#parsing-the-accounting-json-log-files" class="nav-link">Parsing the accounting JSON log files</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#full-syntax" class="nav-link">Full Syntax</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#whats-next" class="nav-link">What's next?</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="jsonlogparser">JsonLogParser</h1>
<p>The <a href="https://github.com/aws-samples/hpc-cost-simulator/blob/main/JsonLogParser.py">JsonLogParser.py</a> script parses job information from a JSON file that contains an array of dicts that contain the required job information.
This allows you to run the Job Analyzer on jobs from an unsupported scheduler as long as you can export the job information in the required JSON format.
The parser also requires you to provide a schema mapping file that maps the field names in your json file to the field names used
by the job analyzer.</p>
<h2 id="json-jobs-file-format">JSON Jobs File Format</h2>
<p>The expected JSON format looks like the following example.</p>
<pre><code>[
    {
        &quot;Job_Id&quot;: &quot;1&quot;,
        &quot;ncpus&quot;: &quot;1&quot;,
        &quot;mem_bytes&quot;: 13843545600,
        &quot;node_count&quot;: 1,
        &quot;ctime&quot;: &quot;2024-06-28T01:00:00&quot;,
        &quot;stime&quot;: &quot;2024-06-28T01:00:00&quot;,
        &quot;walltime&quot;: &quot;2024-06-28T01:00:00&quot;,
        &quot;etime&quot;: &quot;2024-06-28T01:00:00&quot;,
        &quot;queue&quot;: &quot;regress&quot;,
        &quot;project&quot;: &quot;project1&quot;,
        &quot;Exit_status&quot;: &quot;0&quot;,
        &quot;ru_mem_bytes&quot;: 7334404096
    },
    {
        &quot;Job_Id&quot;: &quot;2&quot;,
        &quot;ncpus&quot;: &quot;1&quot;,
        &quot;mem_bytes&quot;: 13843545600,
        &quot;node_count&quot;: 1,
        &quot;ctime&quot;: &quot;2024-06-28T01:00:00&quot;,
        &quot;stime&quot;: &quot;2024-06-28T01:00:00&quot;,
        &quot;walltime&quot;: &quot;2024-06-28T01:00:00&quot;,
        &quot;etime&quot;: &quot;2024-06-28T01:00:00&quot;,
        &quot;queue&quot;: &quot;regress&quot;,
        &quot;project&quot;: &quot;project1&quot;,
        &quot;Exit_status&quot;: &quot;0&quot;,
        &quot;ru_mem_bytes&quot;: 7334404096
    }
]
</code></pre>
<p>The field names aren't fixed, but must be the same for each job record.</p>
<h2 id="json-schema-map-file-format">JSON Schema Map File Format</h2>
<p>The schema map is a JSON file that maps the standard field names used by the parser to field names of your JSON file.
It looks like the following and must contain the following required fields.
For numeric fields like max_mem_gb, you can specify the units and the number will be scaled.
For example if you log contains memory request in bytes, then you can specify that and the number will be converted to GB.</p>
<pre><code>    &quot;job_id&quot;: &quot;Job_Id&quot;,
    &quot;num_cores&quot;: &quot;ncpus&quot;,
    &quot;max_mem_gb&quot;: {&quot;mem_bytes&quot;: {&quot;units&quot;: &quot;b&quot;}},
    &quot;num_hosts&quot;: &quot;node_count&quot;,
    &quot;submit_time&quot;: &quot;ctime&quot;,
    &quot;start_time&quot;: &quot;stime&quot;,

    &quot;run_time&quot;: &quot;walltime&quot;,

    &quot;eligible_time&quot;: &quot;etime&quot;,
    &quot;queue&quot;: &quot;queue&quot;,
    &quot;project&quot;: &quot;project&quot;,

    &quot;exit_status&quot;: &quot;Exit_status&quot;,

    &quot;ru_maxrss&quot;: &quot;ru_mem_bytes&quot;
</code></pre>
<h2 id="parsing-the-accounting-json-log-files">Parsing the accounting JSON log files</h2>
<p>First you must source the setup script to make sure that all required packages are installed.</p>
<pre><code>source setup.sh
</code></pre>
<p>This creates a python virtual environment and activates it.</p>
<p>The script will parse a JSON file that contains the job information.
The parsed data will be written in the output directory which will be created if it does not exist.
The parsed job data will be written out in csv format.</p>
<pre><code>./JsonLogParser.py \
    --input-json &lt;json-jobs-file&gt; \
    --json-schema &lt;json-schema-file&gt;
    --output-csv jobs.csv
</code></pre>
<h2 id="full-syntax">Full Syntax</h2>
<pre><code>usage: JsonLogParser.py [-h] --input-json INPUT_JSON --json-schema-map
                        JSON_SCHEMA_MAP [--output-csv OUTPUT_CSV]
                        [--starttime STARTTIME] [--endtime ENDTIME]
                        [--disable-version-check] [--debug]

Parse JSON file with job results.

optional arguments:
  -h, --help            show this help message and exit
  --input-json INPUT_JSON
                        Json file with parsed job info. (default: None)
  --json-schema-map JSON_SCHEMA_MAP
                        Json file that maps input json field names to
                        SchedulerJobInfo field names. (default: None)
  --output-csv OUTPUT_CSV
                        CSV file where parsed jobs will be written. (default:
                        None)
  --starttime STARTTIME
                        Select jobs after the specified time. Format YYYY-MM-
                        DDTHH:MM:SS (default: None)
  --endtime ENDTIME     Select jobs before the specified time. Format YYYY-MM-
                        DDTHH:MM:SS (default: None)
  --disable-version-check
                        Disable git version check (default: False)
  --debug, -d           Enable debug mode (default: False)
</code></pre>
<h2 id="whats-next">What's next?</h2>
<p>Once completed, you can run step #3 (cost simulation) by following the instructions in for the <a href="../JobAnalyzer/">JobAnalyzer</a>
Since you already generated a CSV file, you will use <a href="../JobAnalyzer/">JobAnalyzer</a> with the <code>csv</code> option.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/jquery-3.6.0.min.js"></script>
        <script src="../js/bootstrap.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
